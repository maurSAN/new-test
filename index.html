<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Harta României — Județe Colorate</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body, html { margin: 0; height: 100%; }
    #map { width: 100%; max-width: 1000px; height: 700px; margin: 0 auto; } /* Mărit */
    .county-label {
      font-size: 12px;
      font-weight: bold;
      color: #000;
      text-align: center;
      pointer-events: none;
      text-shadow: 0 0 3px #fff;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Funcție pentru normalizarea numelor
    function normalizeName(name) {
      if (!name) return '';
      return name.toLowerCase()
        .replace(/[ăâ]/g, 'a')
        .replace(/î/g, 'i')
        .replace(/[șş]/g, 's')
        .replace(/[țţ]/g, 't')
        .replace(/\s+/g, '-') // Spații -> cratimă
        .replace(/[^a-z0-9-]/g, '')
        .replace(/bucurești/g, 'bucuresti')
        .replace(/satu-mare/g, 'satu-mare');
    }

    // Inițializare hartă
    const map = L.map('map', {
      maxBounds: [[43.5, 20.2], [48.7, 29.7]],
      maxBoundsViscosity: 1.0,
      minZoom: 6,
      maxZoom: 12
    }).setView([45.9432, 24.9668], 8); // Zoom mărit

    // Forțează limite
    map.on('drag', function() {
      map.panInsideBounds(map.options.maxBounds);
    });
    map.on('zoomend', function() {
      if (map.getZoom() < map.options.minZoom) {
        map.setZoom(map.options.minZoom);
      }
    });

    // Strat OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // Contur România
    const romaniaOutline = {
      "type": "FeatureCollection",
      "features": [{
        "type": "Feature",
        "properties": { "name": "Romania" },
        "geometry": {
          "type": "MultiPolygon",
          "coordinates": [[[
            [20.2616, 44.2221], [20.3502, 44.8442], [20.4868, 45.2349], [21.0137, 45.6144],
            [21.5429, 45.9432], [22.1378, 46.3498], [22.8972, 47.9871], [23.7993, 47.9871],
            [24.9688, 47.9871], [25.8372, 47.9871], [26.6194, 48.2654], [27.4924, 47.9871],
            [28.8398, 47.7387], [29.6022, 46.5178], [29.1418, 45.4228], [28.2234, 43.6442],
            [27.4924, 43.6442], [26.6984, 43.6187], [25.8372, 43.6187], [24.9688, 43.6187],
            [23.7993, 43.6187], [22.8972, 43.6187], [22.1378, 43.6442], [21.5429, 43.6442],
            [20.4868, 43.6442], [20.2616, 44.2221]
          ]], [
            [28.0, 45.0], [28.5, 45.0], [28.5, 45.5], [28.0, 45.5], [28.0, 45.0] // Delta Dunării
          ]]]
        }
      }]
    };

    L.geoJSON(romaniaOutline, {
      style: {
        color: "#000000",
        weight: 6,
        fill: false
      }
    }).addTo(map);

    // Pane-uri pentru z-index
    map.createPane('bucurestiPane');
    map.getPane('bucurestiPane').style.zIndex = 650;
    map.createPane('otherPane');
    map.getPane('otherPane').style.zIndex = 600;

    // URL GeoJSON
    const geojsonURL = 'https://raw.githubusercontent.com/maurSAN/new-test/main/ro.json';

    // Abrevieri județe
    const abbreviations = {
      "alba": "AB", "arad": "AR", "arges": "AG", "bacau": "BC", "bihor": "BH",
      "bistrita-nasaud": "BN", "botosani": "BT", "brasov": "BV", "braila": "BR",
      "buzau": "BZ", "caras-severin": "CS", "calarasi": "CL", "cluj": "CJ",
      "constanta": "CT", "covasna": "CV", "dambovita": "DB", "dolj": "DJ",
      "galati": "GL", "giurgiu": "GR", "gorj": "GJ", "harghita": "HR",
      "hunedoara": "HD", "ialomita": "IL", "iasi": "IS", "ilfov": "IF",
      "maramures": "MM", "mehedinti": "MH", "mures": "MS", "neamt": "NT",
      "olt": "OT", "prahova": "PH", "satu-mare": "SM", "salaj": "SJ",
      "sibiu": "SB", "suceava": "SV", "teleorman": "TR", "timis": "TM",
      "tulcea": "TL", "vaslui": "VS", "valcea": "VL", "vrancea": "VN",
      "bucuresti": "B"
    };

    // Culori județe
    const colors = {
      "AB": "#e6194b", "AR": "#3cb44b", "AG": "#ffe119", "BC": "#4363d8", "BH": "#f58231",
      "BN": "#911eb4", "BT": "#46f0f0", "BV": "#f032e6", "BR": "#bcf60c", "BZ": "#fabebe",
      "CS": "#008080", "CL": "#e6beff", "CJ": "#9a6324", "CT": "#fffac8", "CV": "#800000",
      "DB": "#aaffc3", "DJ": "#808000", "GL": "#ffd8b1", "GR": "#000075", "GJ": "#808080",
      "HR": "#ffffff", "HD": "#000000", "IL": "#ff7f50", "IS": "#87ceeb", "IF": "#da70d6",
      "MM": "#32cd32", "MH": "#ffb6c1", "MS": "#7b68ee", "NT": "#00ced1", "OT": "#ff69b4",
      "PH": "#cd5c5c", "SM": "#4b0082", "SJ": "#20b2aa", "SB": "#b0e0e6", "SV": "#ff4500",
      "TR": "#2e8b57", "TM": "#da70d6", "TL": "#deb887", "VS": "#5f9ea0", "VL": "#7fff00",
      "VN": "#d2691e", "B": "#8b0000"
    };

    // Încărcare GeoJSON
    fetch(geojsonURL)
      .then(res => {
        if (!res.ok) throw new Error('Fișierul GeoJSON nu s-a încărcat: ' + res.statusText);
        return res.json();
      })
      .then(data => {
        const counties = data.features.map(f => f.properties.NAME_1 || f.properties.name || f.properties.NUME || 'Fără nume');
        console.log('Județe găsite:', counties);
        if (!counties.includes('Bucuresti')) console.error('București lipsește din GeoJSON!');
        if (!counties.includes('Satu Mare')) console.error('Satu Mare lipsește din GeoJSON!');

        const geoLayer = L.geoJSON(data, {
          style: (feature) => {
            const rawName = feature.properties.NAME_1 || '';
            const name = normalizeName(rawName);
            const abbr = abbreviations[name] || "??";
            return {
              color: "#333",
              weight: 3, // Contur județe mai gros
              fillColor: colors[abbr] || "#cccccc",
              fillOpacity: 0.7,
              pane: abbr === "B" ? "bucurestiPane" : "otherPane"
            };
          },
          onEachFeature: (feature, layer) => {
            const rawName = feature.properties.NAME_1 || '';
            const name = normalizeName(rawName);
            const abbr = abbreviations[name] || "??";
            layer.bindTooltip(abbr, {
              permanent: true,
              direction: "center",
              className: 'county-label'
            });
            layer.on('click', function(e) {
              layer.bindPopup(`<b>${rawName}</b><br>Abreviere: ${abbr}<br>(Aici vor fi detalii despre terenuri)`).openPopup();
            });
          }
        }).addTo(map);
        
        map.fitBounds(geoLayer.getBounds(), { padding: [50, 50] }); // Ajustat pentru județe mai mari
      })
      .catch(err => {
        console.error('Eroare la încărcare GeoJSON:', err);
        document.getElementById('map').innerHTML = '<p style="text-align:center;color:red;">Eroare: Nu s-a putut încărca ro.json. Verifică dacă fișierul e în repo!</p>';
      });
  </script>
</body>
</html>
