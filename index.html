<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Harta Județe România</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }
    h1 {
      margin-bottom: 20px;
    }
    #map {
      width: 100%;
      max-width: 800px;
      height: 600px;
      border: 1px solid #ccc;
    }
    .county-label {
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 10px;
      border-radius: 3px;
      padding: 2px 5px;
    }
  </style>
</head>
<body>
  <h1>Județe România</h1>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // URL GeoJSON pentru județe
    const geojsonURL = 'https://raw.githubusercontent.com/maurSAN/harta-test/main/ro.json';

    // Contur România (GeoJSON detaliat, simplificat pentru contur țară)
    const romaniaOutline = {
      "type": "FeatureCollection",
      "features": [{
        "type": "Feature",
        "properties": { "name": "Romania" },
        "geometry": {
          "type": "MultiPolygon",
          "coordinates": [[[
            [20.2616, 44.2221], [20.3502, 44.8442], [20.4868, 45.2349], [21.0137, 45.6144],
            [21.5429, 45.9432], [22.1378, 46.3498], [22.8972, 47.9871], [23.7993, 47.9871],
            [24.9688, 47.9871], [25.8372, 47.9871], [26.6194, 48.2654], [27.4924, 47.9871],
            [28.8398, 47.7387], [29.6022, 46.5178], [29.1418, 45.4228], [28.2234, 43.6442],
            [27.4924, 43.6442], [26.6984, 43.6187], [25.8372, 43.6187], [24.9688, 43.6187],
            [23.7993, 43.6187], [22.8972, 43.6187], [22.1378, 43.6442], [21.5429, 43.6442],
            [20.4868, 43.6442], [20.2616, 44.2221]
          ]]]
        }
      }]
    };

    // Abrevieri județe
    const abbreviations = {
      "alba": "AB", "arad": "AR", "arges": "AG", "bacau": "BC", "bihor": "BH",
      "bistrita-nasaud": "BN", "botosani": "BT", "brasov": "BV", "braila": "BR",
      "buzau": "BZ", "caras-severin": "CS", "calarasi": "CL", "cluj": "CJ",
      "constanta": "CT", "covasna": "CV", "dambovita": "DB", "dolj": "DJ",
      "galati": "GL", "giurgiu": "GR", "gorj": "GJ", "harghita": "HR",
      "hunedoara": "HD", "ialomita": "IL", "iasi": "IS", "ilfov": "IF",
      "maramures": "MM", "mehedinti": "MH", "mures": "MS", "neamt": "NT",
      "olt": "OT", "prahova": "PH", "satu mare": "SM", "salaj": "SJ",
      "sibiu": "SB", "suceava": "SV", "teleorman": "TR", "timis": "TM",
      "tulcea": "TL", "vaslui": "VS", "valcea": "VL", "vrancea": "VN",
      "bucuresti": "B"
    };

    // Culori pentru județe
    const colors = {
      "AB": "#e6194b", "AR": "#3cb44b", "AG": "#ffe119", "BC": "#4363d8", "BH": "#f58231",
      "BN": "#911eb4", "BT": "#46f0f0", "BV": "#f032e6", "BR": "#bcf60c", "BZ": "#fabebe",
      "CS": "#008080", "CL": "#e6beff", "CJ": "#9a6324", "CT": "#fffac8", "CV": "#800000",
      "DB": "#aaffc3", "DJ": "#808000", "GL": "#ffd8b1", "GR": "#000075", "GJ": "#808080",
      "HR": "#ffffff", "HD": "#000000", "IL": "#ff7f50", "IS": "#87ceeb", "IF": "#da70d6",
      "MM": "#32cd32", "MH": "#ffb6c1", "MS": "#7b68ee", "NT": "#00ced1", "OT": "#ff69b4",
      "PH": "#cd5c5c", "SM": "#4b0082", "SJ": "#20b2aa", "SB": "#b0e0e6", "SV": "#ff4500",
      "TR": "#2e8b57", "TM": "#da70d6", "TL": "#deb887", "VS": "#5f9ea0", "VL": "#7fff00",
      "VN": "#d2691e", "B": "#8b0000"
    };

    // Funcție pentru normalizarea numelor
    function normalizeName(name) {
      if (!name) return '';
      return name.toLowerCase()
        .replace(/ă/g, 'a')
        .replace(/â/g, 'a')
        .replace(/î/g, 'i')
        .replace(/ș/g, 's')
        .replace(/ț/g, 't')
        .replace(/\s+/g, '-') // Spații -> cratimă
        .replace(/[^a-z0-9-]/g, ''); // Elimină caractere speciale
    }

    // Inițializează harta
    const map = L.map('map', {
      center: [45.9432, 24.9668],
      zoom: 7,
      minZoom: 7, // Blochează zoom out
      maxZoom: 10, // Limitează zoom in
      maxBounds: [[43.6187, 20.2616], [48.2654, 29.6022]], // Limite precise România
      maxBoundsViscosity: 1.0 // Blochează mișcarea în afara limitelor
    });

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      minZoom: 7,
      maxZoom: 10
    }).addTo(map);

    // Adaugă conturul țării
    L.geoJSON(romaniaOutline, {
      style: {
        color: "#000000", // Contur negru gros
        weight: 5, // Grosime contur țară
        fill: false // Fără umplutură
      }
    }).addTo(map);

    // Creează pane-uri pentru a controla ordinea straturilor
    map.createPane('bucurestiPane');
    map.getPane('bucurestiPane').style.zIndex = 650;
    map.createPane('otherPane');
    map.getPane('otherPane').style.zIndex = 600;

    // Încarcă și afișează GeoJSON pentru județe
    fetch(geojsonURL)
      .then(response => {
        if (!response.ok) throw new Error('Eroare la încărcarea ro.json: ' + response.statusText);
        return response.json();
      })
      .then(data => {
        L.geoJSON(data, {
          style: (feature) => {
            const rawName = feature.properties.NAME_1 || feature.properties.name || feature.properties.NUME || '';
            const name = normalizeName(rawName);
            const abbr = abbreviations[name] || "??";
            return {
              color: "#000000", // Contur negru între județe
              weight: 3, // Grosime contur județe
              fillColor: colors[abbr] || "#cccccc",
              fillOpacity: 0.6,
              pane: abbr === "B" ? "bucurestiPane" : "otherPane"
            };
          },
          onEachFeature: (feature, layer) => {
            const rawName = feature.properties.NAME_1 || feature.properties.name || feature.properties.NUME || '';
            const name = normalizeName(rawName);
            const abbr = abbreviations[name] || "??";
            layer.bindTooltip(abbr, {
              permanent: true,
              direction: "center",
              className: 'county-label'
            });
            layer.on('click', function(e) {
              layer.bindPopup(`<b>${rawName}</b><br>Abreviere: ${abbr}<br>(Aici vor fi detalii despre terenuri)`).openPopup();
            });
          }
        }).addTo(map);
        map.fitBounds(L.geoJSON(data).getBounds());
        console.log('Nume din JSON:', data.features.map(f => f.properties.NAME_1));
      })
      .catch(error => {
        console.error('Eroare la fetch:', error);
        alert('Nu s-a putut încărca ro.json. Verifică calea sau URL-ul.');
      });
  </script>
</body>
</html>
