<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Harta Județe România</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      color: #333;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      margin: 0;
    }
    h1 {
      margin-bottom: 20px;
    }
    #map {
      width: 100%;
      max-width: 800px;
      height: 600px;
      border: 1px solid #ccc;
    }
    .county-label {
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      font-size: 10px;
      border-radius: 3px;
      padding: 2px 5px;
    }
  </style>
</head>
<body>
  <h1>Județe România</h1>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // URL GeoJSON (folosește URL-ul GitHub)
    const geojsonURL = 'https://raw.githubusercontent.com/maurSAN/harta-test/main/ro.json';

    // Abrevieri județe
    const abbreviations = {
      "alba": "AB", "arad": "AR", "arges": "AG", "bacau": "BC", "bihor": "BH",
      "bistrita-nasaud": "BN", "botosani": "BT", "brasov": "BV", "braila": "BR",
      "buzau": "BZ", "caras-severin": "CS", "calarasi": "CL", "cluj": "CJ",
      "constanta": "CT", "covasna": "CV", "dambovita": "DB", "dolj": "DJ",
      "galati": "GL", "giurgiu": "GR", "gorj": "GJ", "harghita": "HR",
      "hunedoara": "HD", "ialomita": "IL", "iasi": "IS", "ilfov": "IF",
      "maramures": "MM", "mehedinti": "MH", "mures": "MS", "neamt": "NT",
      "olt": "OT", "prahova": "PH", "satu mare": "SM", "salaj": "SJ",
      "sibiu": "SB", "suceava": "SV", "teleorman": "TR", "timis": "TM",
      "tulcea": "TL", "vaslui": "VS", "valcea": "VL", "vrancea": "VN",
      "bucuresti": "B"
    };

    // Culori pentru județe
    const colors = {
      "AB": "#e6194b", "AR": "#3cb44b", "AG": "#ffe119", "BC": "#4363d8", "BH": "#f58231",
      "BN": "#911eb4", "BT": "#46f0f0", "BV": "#f032e6", "BR": "#bcf60c", "BZ": "#fabebe",
      "CS": "#008080", "CL": "#e6beff", "CJ": "#9a6324", "CT": "#fffac8", "CV": "#800000",
      "DB": "#aaffc3", "DJ": "#808000", "GL": "#ffd8b1", "GR": "#000075", "GJ": "#808080",
      "HR": "#ffffff", "HD": "#000000", "IL": "#ff7f50", "IS": "#87ceeb", "IF": "#da70d6",
      "MM": "#32cd32", "MH": "#ffb6c1", "MS": "#7b68ee", "NT": "#00ced1", "OT": "#ff69b4",
      "PH": "#cd5c5c", "SM": "#4b0082", "SJ": "#20b2aa", "SB": "#b0e0e6", "SV": "#ff4500",
      "TR": "#2e8b57", "TM": "#da70d6", "TL": "#deb887", "VS": "#5f9ea0", "VL": "#7fff00",
      "VN": "#d2691e", "B": "#8b0000"
    };

    // Funcție pentru normalizarea numelor
    function normalizeName(name) {
      if (!name) return '';
      return name.toLowerCase()
        .replace(/ă/g, 'a')
        .replace(/â/g, 'a')
        .replace(/î/g, 'i')
        .replace(/ș/g, 's')
        .replace(/ț/g, 't')
        .replace(/\s+/g, '-') // Spații -> cratimă
        .replace(/[^a-z0-9-]/g, ''); // Elimină caractere speciale
    }

    // Inițializează harta
    const map = L.map('map').setView([45.9432, 24.9668], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);

    // Creează pane-uri pentru a controla ordinea straturilor
    map.createPane('bucurestiPane');
    map.getPane('bucurestiPane').style.zIndex = 650;
    map.createPane('otherPane');
    map.getPane('otherPane').style.zIndex = 600;

    // Încarcă și afișează GeoJSON
    fetch(geojsonURL)
      .then(response => {
        if (!response.ok) throw new Error('Eroare la încărcarea ro.json: ' + response.statusText);
        return response.json();
      })
      .then(data => {
        L.geoJSON(data, {
          style: (feature) => {
            const rawName = feature.properties.NAME_1 || feature.properties.name || feature.properties.NUME || '';
            const name = normalizeName(rawName);
            const abbr = abbreviations[name] || "??";
            return {
              color: "#000000", // Contur negru
              weight: 3, // Grosime contur
              fillColor: colors[abbr] || "#cccccc",
              fillOpacity: 0.6,
              pane: abbr === "B" ? "bucurestiPane" : "otherPane"
            };
          },
          onEachFeature: (feature, layer) => {
            const rawName = feature.properties.NAME_1 || feature.properties.name || feature.properties.NUME || '';
            const name = normalizeName(rawName);
            const abbr = abbreviations[name] || "??";
            layer.bindTooltip(abbr, {
              permanent: true,
              direction: "center",
              className: 'county-label'
            });
            layer.on('click', function(e) {
              layer.bindPopup(`<b>${rawName}</b><br>Abreviere: ${abbr}<br>(Aici vor fi detalii despre terenuri)`).openPopup();
            });
          }
        }).addTo(map);
        map.fitBounds(L.geoJSON(data).getBounds());
        console.log('Nume din JSON:', data.features.map(f => f.properties.NAME_1));
      })
      .catch(error => {
        console.error('Eroare la fetch:', error);
        alert('Nu s-a putut încărca ro.json. Verifică calea sau URL-ul.');
      });
  </script>
</body>
</html>